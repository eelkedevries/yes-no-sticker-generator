<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My review policy</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; margin: 24px; color: #111; background: #fff; }
    .wrap { max-width: 1080px; }

.intro-panel { padding: 16px 16px 10px 16px; }
.intro-heading { font-size: 28px; margin: 0 0 10px 0; }
.section-heading { font-size: 20px; margin: 0 0 12px 0; }

    h1 { font-size: 28px; margin: 0 0 10px 0; }
    h2 { font-size: 20px; margin: 20px 0 10px 0; }
    .subtext {
      margin: 0 0 14px 0;
      line-height: 1.45;
      font-size: 14px;
      color: #222;
      max-width: 1000px;
    }

    .iconbar { display: inline-flex; gap: 10px; vertical-align: middle; margin-left: 6px; }
    .iconlink { display: inline-flex; align-items: center; justify-content: center; width: 22px; height: 22px; }
    .iconlink svg { width: 20px; height: 20px; display: block; }

    .panel {
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 14px 14px 6px 14px;
      background: #f7f8fa;
      margin: 10px 0 16px 0;
    }
    .panel-title {
      font-size: 15px;
      font-weight: 700;
      margin: 0 0 10px 0;
      color: #111;
    }

    .subsection {
      margin-top: 18px;
      padding-top: 14px;
      border-top: none;
    }
    .subsection:first-of-type {
      margin-top: 0;
      padding-top: 0;
      border-top: none;
    }
    .subheading {
      font-size: 18px;
      font-weight: 700;
      margin: 0 0 10px 0;
      color: #111;
    }



    .section-box{
      border: 1px solid #d7dee9;
      border-radius: 12px;
      padding: 12px 12px;
      background: #f7f8fa;
      margin: 0;
    }
    .section-box--hf{ background: #f7f8fa; }
    .section-box--sizes{ background: #f7f8fa; }
.row { display: flex; gap: 12px; flex-wrap: wrap; margin: 12px 0; align-items: flex-start; }
    .col { flex: 1 1 420px; }

    label { display: block; font-size: 14px; margin-bottom: 6px; }
    input[type="text"], textarea {
      width: 100%;
      padding: 10px 12px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #fff;
      box-sizing: border-box;
    }
    textarea { resize: vertical; min-height: 90px; }

    .radio-group { display: grid; gap: 8px; margin-top: 8px; }
    @media (min-width: 900px) {
      .radio-group { grid-template-columns: 1fr 1fr; }
    }

    .radio-item {
      display: flex; gap: 10px; align-items: flex-start;
      padding: 10px 12px; border: 1px solid #ddd; border-radius: 10px; background: #fff;
    }
    .radio-item input[type="radio"] { margin-top: 3px; transform: scale(1.05); }
    .radio-label { display: grid; gap: 2px; }
    .radio-name { font-weight: 700; font-size: 14px; color: #111; }
    .radio-pair { font-size: 13px; color: #333; line-height: 1.35; }

    .option-row {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      margin: 8px 0;
    }
    .option-row input[type="checkbox"] { transform: translateY(1px); }

    .font-control {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  padding: 10px 12px;
  border: 1px solid #ddd;
  border-radius: 12px;
  background: #fafafa;
}
.font-control .label { font-size: 14px; font-weight: 700; color: #111; }
.font-control-row {
  display: inline-flex;
  align-items: center;
  gap: 10px;
}
.font-size-box {
  width: 70px;
  text-align: center;
  font-size: 16px;
}
.stepper {
  display: inline-flex;
  flex-direction: column;
  gap: 6px;
}
.stepper button {
  width: 36px;
  height: 32px;
  padding: 0;
  font-size: 18px;
  line-height: 1;
  border: 1px solid #ccc;
  border-radius: 8px;
  background: #fff;
  cursor: pointer;
}
.stepper button:active { transform: translateY(1px); }
.stepper button:disabled {
  background: #f0f0f0;
  color: #888;
  border-color: #ddd;
  cursor: not-allowed;
  opacity: 0.65;
}


    .adjusters-row {
      display: flex;
      gap: 12px;
      flex-wrap: nowrap;
      align-items: center;
      overflow-x: auto;
      padding-bottom: 6px;
    }

    .actions {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 8px;
      margin: 10px 0 0 0;
    }
    button.action {
      width: 100%;
      padding: 10px 10px;
      font-size: 14px;
      line-height: 1.2;
      min-height: 44px;
      box-sizing: border-box;
      appearance: none;
      -webkit-appearance: none;
      white-space: nowrap;
      cursor: pointer;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #fff;
      text-align: center;
    }
    /* Keep dimensions identical when disabled; only reduce opacity and change cursor. */
    button.action:disabled {
      background: #fff;
      border-color: #ccc;
      color: inherit;
      opacity: 0.55;
      cursor: not-allowed;
    }

    /* Avoid any UA focus styling that could alter perceived button size */
    button.action:focus { outline: none; }
    button.action:focus-visible { outline: 2px solid #999; outline-offset: 2px; }

    .export-status {
      margin-top: 10px;
      font-size: 13px;
      line-height: 1.25;
      min-height: 2.6em; /* reserve space for up to ~2 lines without layout jump */
      white-space: normal;
    }
    .export-status.info { color: #333; }
    .export-status.ok { color: #0a6; }
    .export-status.err { color: #b00; }
    button.action:active { transform: translateY(1px); }

    .option-row {
      margin-top: 10px;
    }
    label.check {
      display: inline-flex;
      gap: 10px;
      align-items: center;
      font-size: 14px;
      user-select: none;
      cursor: pointer;
    }
    label.check input {
      width: 16px;
      height: 16px;
    }


    .divider { display: none; }

    .warning {
      display: none;
      border: 1px solid #d22;
      background: #fff5f5;
      color: #7a0a0a;
      padding: 10px 12px;
      border-radius: 10px;
      font-size: 14px;
      margin: 10px 0 12px 0;
      line-height: 1.35;
    }


    .limit-msg {
      display: none;
      color: #b00000;
      font-size: 14px;
      margin-top: 10px;
      line-height: 1.35;
    }

    canvas { width: 100%; border: 1px solid #ddd; border-radius: 0; display: block; background: transparent; cursor: zoom-in; }
    canvas.rc-on { border-radius: 12px; }

    .inline-grow { flex: 1 1 520px; min-width: 260px; }
  

/* Lightbox (enlarged preview) */
.lightbox {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}
.lightbox.open { display: flex; }
.lightbox-backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.75);
}
.lightbox-content {
  position: relative;
  z-index: 1;
  max-width: 96vw;
  max-height: 96vh;
  padding: 16px;
}
.lightbox-img {
  display: block;
  max-width: 96vw;
  max-height: 96vh;
  height: auto;
  width: auto;
  box-shadow: 0 12px 30px rgba(0,0,0,0.35);
}
.lightbox-close {
  position: absolute;
  top: 10px;
  right: 10px;
  width: 40px;
  height: 40px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.35);
  background: rgba(0,0,0,0.45);
  color: #fff;
  font-size: 26px;
  line-height: 1;
  cursor: pointer;
}
.lightbox-close:active { transform: translateY(1px); }
  
@media (max-width: 520px) {
    .actions { grid-template-columns: repeat(2, minmax(0, 1fr)); }
}

</style>
</head>

<body>
  <div class="wrap">
    <div class="panel intro-panel">
      <h1 class="intro-heading">My review policy</h1>

      <p class="subtext">
      This YES/NO image generator helps researchers share their personal review policy in any way they want (for example, a social media post or a quick reply to unwanted review requests), including automated mass invitations, predatory journals, and high-fee for-profit publishers that rely on unpaid reviewing and often place accepted papers behind paywalls.
      <strong>#MyReviewPolicy</strong>
      &nbsp;Read more here: <a href="#" id="readMoreLink">[link coming soon]</a>
      <span class="iconbar" aria-label="Links">
        <a class="iconlink" href="https://www.linkedin.com/in/eelkedevries" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
          <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
            <path fill="#0A66C2" d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.036-1.852-3.036-1.853 0-2.136 1.445-2.136 2.939v5.666H9.35V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.368-1.85 3.6 0 4.269 2.368 4.269 5.455v6.286zM5.337 7.433a2.062 2.062 0 1 1 0-4.124 2.062 2.062 0 0 1 0 4.124zM6.815 20.452H3.858V9h2.957v11.452z"/>
          </svg>
        </a>
        <a class="iconlink" href="https://github.com/eelkedevries/" target="_blank" rel="noopener noreferrer" aria-label="GitHub">
          <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
            <path fill="#111" d="M12 .5C5.73.5.75 5.62.75 12.05c0 5.14 3.19 9.5 7.62 11.04.56.11.77-.25.77-.56 0-.27-.01-1.17-.02-2.12-3.1.69-3.75-1.25-3.75-1.25-.5-1.33-1.23-1.68-1.23-1.68-1-.71.08-.7.08-.7 1.11.08 1.7 1.18 1.7 1.18.98 1.74 2.57 1.24 3.2.95.1-.73.38-1.24.69-1.52-2.48-.29-5.08-1.28-5.08-5.69 0-1.26.44-2.29 1.17-3.1-.12-.3-.51-1.52.11-3.16 0 0 .95-.31 3.12 1.18a10.7 10.7 0 0 1 2.84-.39c.96 0 1.93.13 2.84.39 2.17-1.49 3.12-1.18 3.12-1.18.62 1.64.23 2.86.11 3.16.73.81 1.17 1.84 1.17 3.1 0 4.42-2.61 5.39-5.1 5.68.39.35.74 1.04.74 2.11 0 1.52-.02 2.74-.02 3.11 0 .31.2.68.78.56 4.42-1.54 7.61-5.9 7.61-11.04C23.25 5.62 18.27.5 12 .5z"/>
          </svg>
        </a>
      </span>
      </p>

    </div>

<div class="panel" id="imagePanel">
<div id="overflowWarning" class="warning" role="status" aria-live="polite">
        Some text does not fit in the image at the current font sizes. Reduce the relevant font size, shorten the text, or disable header/footer.
      </div>

      <div style="margin-top:12px;">
        <canvas id="c"></canvas>
      </div>

      <div class="actions">
        <button class="action" id="downloadBtn">Download PNG</button>
        <button class="action" id="copyBtn">Copy image</button>
        <button class="action" id="copyLinkBtn">Copy link</button>
        <button class="action" id="clearBtn">Clear</button>
      </div>
      <div id="exportStatus" class="export-status" role="status" aria-live="polite"></div>

      <div class="option-row">
        <label class="check"><input type="checkbox" id="roundedCorners"> Rounded corners</label>
      </div>
    </div>

<div class="panel" id="adjustPanel">
      <h2 class="section-heading">Personalize message</h2>

<div class="row">
        <div class="col">
          <label for="noText">custom NO text</label>
          <textarea id="noText">Publishing fees + paywalls</textarea>
        </div>
        <div class="col">
          <label for="yesText">custom YES text</label>
          <textarea id="yesText">Diamond open access</textarea>
        </div>
      </div>
    </div>

    


      <div class="divider"></div>
<div class="subsection">
<div class="section-box section-box--hf">
<div class="option-row">
        <input id="showHeader" type="checkbox" checked />
        <label for="showHeader" style="margin:0; font-weight:700;">Add heading text on image</label>
        <div class="inline-grow">
          <input id="headerText" type="text" value="MY PEER REVIEW POLICY" />
        </div>
      </div>

            <div class="option-row">
        <input id="showFooter" type="checkbox" />
        <label for="showFooter" style="margin:0; font-weight:700;">Add footer text below image</label>
        <div class="inline-grow">
          <input id="footerText" type="text" value="" placeholder="(optional)" />
        </div>
      </div>
</div>
    </div>

    

<div class="subsection">
      <div class="section-box section-box--sizes">
        <h3 class="subheading">Adjust text sizes</h3>
        <div class="adjusters-row" aria-label="Adjust text sizes">
        <div class="font-control" aria-label="Policy font size control">
          <div class="label">Policy</div>
          <div class="font-control-row">
            <input id="baseFontSize" class="font-size-box" type="text" inputmode="numeric" value="64" aria-label="Policy text size" />
            <div class="stepper" aria-label="Increase or decrease policy font size">
              <button id="fontPlus" type="button" aria-label="Increase policy font size">+</button>
              <button id="fontMinus" type="button" aria-label="Decrease policy font size">−</button>
            </div>
          </div>
        </div>

        <div class="font-control" aria-label="Header font size control">
          <div class="label">Header</div>
          <div class="font-control-row">
            <input id="headerFontSize" class="font-size-box" type="text" inputmode="numeric" value="40" aria-label="Header text size" />
            <div class="stepper" aria-label="Increase or decrease header font size">
              <button id="headerPlus" type="button" aria-label="Increase header font size">+</button>
              <button id="headerMinus" type="button" aria-label="Decrease header font size">−</button>
            </div>
          </div>
        </div>

        <div class="font-control" aria-label="Footer font size control">
          <div class="label">Footer</div>
          <div class="font-control-row">
            <input id="footerFontSize" class="font-size-box" type="text" inputmode="numeric" value="40" aria-label="Footer text size" />
            <div class="stepper" aria-label="Increase or decrease footer font size">
              <button id="footerPlus" type="button" aria-label="Increase footer font size">+</button>
              <button id="footerMinus" type="button" aria-label="Decrease footer font size">−</button>
            </div>
          </div>
        </div>
      </div>
      </div>
      <div id="textSizeLimitMsg" class="limit-msg" role="status" aria-live="polite"></div>
    

    
    </div>
  </div>

  <script>
    // -----------------------
    // Configuration
    // -----------------------
    const STICKER_W = 1800;
    const STICKER_H = 360;


    // Public "read more" link (update to your project page)
    const READ_MORE_URL = "https://github.com/eelkedevries/my-review-policy";
    const HEADER_H = 90;
    const FOOTER_MIN_H = 70;

    const COLORS = {
      bg: "#000000",
      sep: "#E6E6E6",
      no: "#E53935",
      yes: "#008A3B",
      text: "#FFFFFF",
      titleText: "#CFCFCF",
      headerBg: "#FFFFFF",
      headerText: "#000000",
      footerBg: "#FFFFFF",
      footerText: "#000000"
    };

    const PRESETS = {
      p1: { no: "Publishing fees + paywalls", yes: "Diamond open access" }
    };

    const DEFAULT_STATE = {
      preset: "",
      noText: PRESETS.p1.no,
      yesText: PRESETS.p1.yes,
      policyFontSize: 64,
      showHeader: true,
      headerText: "MY PEER REVIEW POLICY",
      headerFontSize: 50,
      showFooter: false,
      footerText: "",
      footerFontSize: 40,
      roundedCorners: true
    };

    // -----------------------
    // DOM
    // -----------------------
    const canvas = document.getElementById("c");
    const ctx = canvas ? canvas.getContext("2d") : null;
    // Offscreen canvas for robust "fit" checks (prevents font-size controls from exceeding available space)
    const fitCanvas = document.createElement("canvas");
    fitCanvas.width = STICKER_W;
    fitCanvas.height = STICKER_H;
    const fitCtx = fitCanvas.getContext("2d");

    let currentMaxPolicyFontSize = 140;
    let currentMaxHeaderFontSize = 140;



// Lightbox DOM (optional; guarded to avoid breaking initial render)
const lightbox = document.getElementById("lightbox");
const lightboxBackdrop = document.getElementById("lightboxBackdrop");
const lightboxClose = document.getElementById("lightboxClose");
const lightboxImg = document.getElementById("lightboxImg");

function openLightbox() {
  if (!lightbox || !lightboxImg) return;
  try { lightboxImg.src = canvas.toDataURL("image/png"); } catch (e) {}
  lightbox.classList.add("open");
  lightbox.setAttribute("aria-hidden", "false");
  document.body.style.overflow = "hidden";
}

function closeLightbox() {
  if (!lightbox) return;
  lightbox.classList.remove("open");
  lightbox.setAttribute("aria-hidden", "true");
  document.body.style.overflow = "";
}


    const readMoreLink = document.getElementById("readMoreLink");
    const noInput = document.getElementById("noText");
    const yesInput = document.getElementById("yesText");
    const presetRadios = Array.from(document.querySelectorAll('input[name="preset"]'));

    const showHeader = document.getElementById("showHeader");
    const headerTextInput = document.getElementById("headerText");

    const showFooter = document.getElementById("showFooter");
    const footerTextInput = document.getElementById("footerText");

    const roundedCorners = document.getElementById("roundedCorners");

    const baseFontSizeInput = document.getElementById("baseFontSize");
    const headerFontSizeInput = document.getElementById("headerFontSize");
    const footerFontSizeInput = document.getElementById("footerFontSize");

    const fontPlusBtn = document.getElementById("fontPlus");
    const fontMinusBtn = document.getElementById("fontMinus");
    const headerPlusBtn = document.getElementById("headerPlus");
    const headerMinusBtn = document.getElementById("headerMinus");
    const footerPlusBtn = document.getElementById("footerPlus");
    const footerMinusBtn = document.getElementById("footerMinus");

    const overflowWarning = document.getElementById("overflowWarning");
    const textSizeLimitMsg = document.getElementById("textSizeLimitMsg");

    const downloadBtn = document.getElementById("downloadBtn");
    const exportStatus = document.getElementById("exportStatus");
    const copyBtn = document.getElementById("copyBtn");
    const copyLinkBtn = document.getElementById("copyLinkBtn");
    const clearBtn = document.getElementById("clearBtn");

    // -----------------------
    // Helpers
    // -----------------------
    function clamp(n, a, b) { return Math.max(a, Math.min(b, n)); }
    function parseIntOr(fallback, v) {
      const n = parseInt(v, 10);
      return Number.isFinite(n) ? n : fallback;
    }

    // Fast string hash for cache keys (FNV-1a, 32-bit)
    function fnv1a(str) {
      str = String(str ?? "");
      let h = 2166136261;
      for (let i = 0; i < str.length; i++) {
        h ^= str.charCodeAt(i);
        h = Math.imul(h, 16777619);
      }
      return h >>> 0;
    }

    // Cache max font sizes so we do not recompute expensive "fit" bounds on every render.
    const _maxCache = {
      policyKey: null,
      policyVal: 140,
      headerKey: null,
      headerVal: 140
    };

    function hasInImageTitle() {
      return !!(showHeader && showHeader.checked && headerTextInput && headerTextInput.value.trim().length > 0);
    }

    function showSizeLimitMessage(msg) {
      if (!textSizeLimitMsg) return;
      textSizeLimitMsg.textContent = msg;
      textSizeLimitMsg.style.display = "block";
    }
    function clearSizeLimitMessage() {
      if (!textSizeLimitMsg) return;
      textSizeLimitMsg.textContent = "";
      textSizeLimitMsg.style.display = "none";
    }


    function refreshSizeLimitMessage(maxPolicy, maxHeader) {
      // Show a persistent explanation when the user is at the maximum size for the available space.
      // We suppress the message for the initial policy auto-fit state.
      const hasTitle = (showHeader && showHeader.checked) && (headerTextInput && headerTextInput.value.trim().length > 0);

      const atPolicyMax = (getPolicyFontSize() >= (maxPolicy - 0.0001));
      const atHeaderMax = hasTitle && (getHeaderFontSize() >= (maxHeader - 0.0001));

      if (atPolicyMax && atHeaderMax) {
        showSizeLimitMessage("Heading and policy text sizes cannot be increased further because they would not fit in the image.");
 